"use strict";define(function(){return ng.core.Class({constructor:[ng.http.Http,function(a){this._http=a,this.onLanguageChange=new ng.core.EventEmitter,this._properties={},this._loading=!1,this._pendingRequests=[],this.setLanguage(this._getDefaultLanguage())}],setLanguage:function(a){var b=this;this._currentLang!==a&&(this._currentLang=a,this._loadProperties().subscribe(function(){b.onLanguageChange.emit()}))},getCurrentLanguage:function(){return this._currentLang},getValues:function(a){var b=this,c=new ng.core.EventEmitter;return this._loading?this._pendingRequests.push({params:a,eventEmitter:c}):setTimeout(function(){c.emit(b._getValues(a))},0),c},_getDefaultLanguage:function(){var a=navigator.language.split("-")[0];return/(fr|en)/gi.test(a)?a:"en"},_getValues:function(a){var b=this,c={};return a.forEach(function(a,d,e){c[a]=b._getValue(a)}),c},_getValue:function(a){return this._properties[this._currentLang].hasOwnProperty(a)?this._properties[this._currentLang][a]:a},_checkPendingRequests:function(){var a=this;this._pendingRequests.forEach(function(b,c,d){var e=a._getValues(b.params);b.eventEmitter.emit(e)}),this._pendingRequests=[]},_loadProperties:function(){var a=this,b=new ng.core.EventEmitter;return this._properties.hasOwnProperty(this._currentLang)||this._loading?setTimeout(function(){b.emit()},0):(this._loading=!0,this._http.get("data/"+this._currentLang+".json").subscribe(function(c){a._properties[a._currentLang]=c.json(),a._loading=!1,a._checkPendingRequests(),b.emit()})),b}})});